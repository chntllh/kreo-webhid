import {
  buttonBindingKeys,
  ButtonBindingName,
  KreoDevice,
} from "@/api/HIDDevice";
import { Flex, NativeSelect, Separator } from "@chakra-ui/react";
import { CardComponent } from "../ui/CardComponent";
import { useEffect, useState } from "react";
import { ButtonMappingKey, SvgPath } from "@/types";
import { MouseSvg } from "../svg/MouseSvg";

export const KeymapPanel = ({ device }: { device: KreoDevice }) => {
  const [selected, setSelected] = useState<ButtonMappingKey | undefined>();

  const [localButtonValue, setLocalButtonValue] =
    useState<ButtonBindingName>("Off");

  useEffect(() => {
    setLocalButtonValue(device.buttonMapping[selected as ButtonMappingKey]);
  }, [selected, device.buttonMapping]);

  const handleChange = (value: ButtonBindingName) => {
    if (!selected) return;
    setLocalButtonValue(value);
    device.buttonMapping.setBinding(selected, value);
  };

  const interactivePaths: SvgPath[] = [
    {
      d: "M335.37 600.943c48.638-6.087 89.464-38.746 121.917-97.527 10.16-18.404 16.554-35.937 20.753-56.916 1.415-7.07 1.8-13.825 1.8-31.5 0-26.09.38-23.716-11.994-75.048l-8.505-35.284 1.984-18.084c5.369-48.94 7.52-90.403 6.724-129.584-.537-26.425-2.317-49.477-4.186-54.212-.372-.942-1.487-1.97-2.478-2.284-1.06-.336-2.062-1.954-2.432-3.923-.446-2.377-2.581-5.248-7.355-9.886-34.106-33.138-81.422-56.483-125.241-61.794-11.05-1.34-12.875-.788-13.121 3.971L313.1 31.5l-.46-2.5c-.9-4.892-1.98-5.317-11.75-4.614-24.988 1.796-52.21 11.312-79.62 27.83-12.721 7.667-34.475 23.946-45.103 33.754-6.72 6.201-8.294 8.351-12.303 16.814l-4.596 9.704.302 48.192.302 48.192-3.258.61c-6.215 1.166-6.41 2.282-5.285 30.13 2.152 53.291 1.954 51.217 5.248 54.969l2.922 3.328-2.144 2.9c-2.143 2.899-2.143 2.91-.493 16.296 2.32 18.829 2.178 21.196-2.497 41.395-6.174 26.673-7.076 32.477-7.696 49.505-1.097 30.112 4.294 57.135 16.658 83.495 21.43 45.69 68.383 89.062 111.48 102.976 18.44 5.953 43.387 8.617 60.564 6.467m-42.746-7.425c-33.26-7.342-65.125-27.187-91.803-57.172l-7.449-8.372-.004-21.737c-.006-29.762-2.644-63.054-8.093-102.102-1.865-13.367-1.89-14.492-.353-16.19 1.441-1.593 1.51-2.69.536-8.635-1.409-8.603-5.07-36.283-5.079-38.403-.005-1.063 4.566-3.785 13.743-8.185 7.563-3.625 28.15-13.646 45.75-22.269s36.678-17.891 42.395-20.597l10.395-4.92 10.542 6.657c5.798 3.661 11.47 6.655 12.605 6.652s6.942-3.043 12.906-6.755l10.842-6.75 29.158 14.32a40204 40204 0 0 1 54.015 26.582c13.672 6.745 25.282 12.405 25.8 12.577.557.186-.297 11.743-2.09 28.298-6.127 56.545-9.626 102.025-10.655 138.483-.736 26.102.198 23.418-13.804 39.68-23.416 27.195-51.07 44.167-81.109 49.779-10.244 1.913-37.746 1.377-48.248-.941m-111.152-81.53c-13.112-19.602-23.073-44.394-27.226-67.758-2.41-13.567-2.925-41.04-.987-52.73 2.486-14.997 8.53-40.604 9.163-38.825.357 1.004 1.453 8.942 2.436 17.64 1.17 10.367 2.28 16.308 3.221 17.25.81.809 3.342 1.435 5.805 1.435 2.404 0 4.646.447 4.984.994.92 1.487 5.152 33.717 7.487 57.006 2.333 23.26 4.73 70.699 3.708 73.362-.971 2.532-1.906 1.621-8.591-8.374m258.273-11.238c1.23-36.398 5.739-91.204 12.155-147.75 1.903-16.775 3.463-31.287 3.466-32.25.02-6.22 2.592 2.203 9.31 30.5 9.38 39.502 10.081 44.015 10.06 64.75-.034 33.17-8.477 61.42-28.32 94.75-3.355 5.638-6.383 10.25-6.728 10.25s-.319-9.112.057-20.25m8.402-167.924c-.215-.645.62-7.869 1.855-16.053 6.248-41.39 8.68-87.991 8.221-157.523-.193-29.288-.072-53.25.268-53.25 1.146 0 2.925 17.878 4.005 40.267 1.957 40.528-1.275 95.192-9.784 165.483-2.439 20.15-3.398 24.577-4.565 21.076m-268.324.095c-.764-1.237-5.738-44.398-10.996-95.421-3.393-32.93-3.635-37.573-4.082-78.5-.448-41.122-.371-43.719 1.414-47.5l1.888-4 .62 31.5c.34 17.325 1.085 37.35 1.656 44.5 3.375 42.32 7.044 75.275 13.187 118.465l4.048 28.466-2.204 1.784c-2.501 2.026-4.553 2.288-5.53.706m236.049-14.727c-14.3-7.04-36.8-18.088-50-24.55l-24-11.751.693-16.697c.382-9.183 2.352-55.468 4.379-102.856s3.38-87.785 3.007-89.771c-.703-3.745-5.289-9.784-8.966-11.808-1.162-.64-6.163-2.338-11.113-3.774-11.06-3.21-11.465-3.822-11.485-17.375l-.015-9.888 6.75.686c21.84 2.221 51.164 12.118 74.634 25.191 17.179 9.569 38.862 25.698 49.849 37.08l3.732 3.868 1.066 36.975c1.88 65.207-.852 128.495-7.662 177.476-2.573 18.505-2.886 20.002-4.178 19.997-.38-.002-12.391-5.763-26.691-12.803M188.5 309c-5.68-38.217-10.177-76.988-13.69-118-1.721-20.1-3.127-82.922-2.02-90.302.634-4.228 1.396-5.186 10.383-13.064 38.08-33.38 81.388-54.895 115.35-57.305l8.849-.628-.015 9.9c-.009 5.907-.513 10.836-1.25 12.222-.932 1.753-3.934 3.226-12.224 6-13.926 4.66-15.527 6.53-15.48 18.075.018 4.181 2.671 52.152 5.897 106.602s5.792 99.082 5.703 99.183c-.285.32-98.124 48.01-98.294 47.912-.089-.052-1.533-9.32-3.209-20.595m117.38-20.098c-6.546-4.198-9.508-6.69-9.508-8.001 0-1.047-.891-17.54-1.98-36.652-4.948-86.828-8.344-169.776-7.05-172.194 1.388-2.593 9.648-7.606 15.822-9.602 8.045-2.6 18.338-1.648 26.704 2.47 3.607 1.776 7.277 4.327 8.156 5.67 2.88 4.395.73 184.796-2.477 207.74l-.675 4.833-9.5 5.86c-5.225 3.224-9.609 5.887-9.742 5.918-.134.03-4.521-2.688-9.75-6.042m16.492-21.466c2.475-1.397 5.063-3.277 5.75-4.179.921-1.208 1.25-8.062 1.25-26.048V212.8l-3.4-3.4c-3.237-3.237-3.745-3.4-10.6-3.4s-7.363.163-10.6 3.4l-3.4 3.4v48.826l2.75 2.534c7.195 6.629 11.075 7.326 18.25 3.276m-12.85-3.442-4.15-3.007v-22.911c0-12.602.28-23.64.621-24.531 1.722-4.488 12.213-6.037 16.744-2.472l2.635 2.072v47.851l-4.75 2.983c-2.612 1.64-5.245 2.992-5.85 3.002s-2.967-1.334-5.25-2.987m13.35-96.682c6.46-.376 7.29-.69 10.75-4.063l3.75-3.655-.006-32.047c-.003-19.277-.424-33.552-1.055-35.824-2.41-8.678-10.645-13.728-22.368-13.717-11.29.01-18.09 3.172-21.594 10.038-1.852 3.63-1.975 5.923-1.932 36.166.049 35.195.113 35.642 5.82 40.372 3.017 2.501 4.201 2.807 11.5 2.963 4.474.096 11.285-.009 15.135-.233z",
      key: "body",
      interactive: false,
    },
    {
      d: "M191.586 327.909c-.828-4.965-4.166-27.454-5.414-36.472-5.87-42.427-10.99-91.735-12.138-116.912-1.329-29.13-1.836-71.02-.905-74.796.833-3.38 2.617-5.405 11.504-13.06 27.025-23.28 55.657-40.399 82.714-49.454 12.876-4.31 22.75-6.236 36.303-7.083l3.622-.226-.003 6.02c-.006 10.392-.707 15.597-2.274 16.874-1.202.98-6.15 3.117-11.536 4.982-10.027 3.473-13.122 5.482-14.338 9.308-1.448 4.555-1.458 4.329 5.916 130.851 4.003 68.69 4.716 81.17 4.716 82.587 0 1.223 2.888-.301-28.807 15.204-40.173 19.653-68.636 33.44-69.034 33.44-.063 0-.21-.568-.326-1.263z",
      key: "left",
      interactive: true,
    },
    {
      d: "M437.66 328.543c-9.232-4.364-95.095-46.494-95.405-46.813-.124-.128.89-26.386 2.252-58.351 4.253-99.772 5.11-121.77 5.445-139.842l.215-11.643-1.098-2.231c-1.263-2.565-3.982-5.997-6.18-7.797-1.693-1.388-4.316-2.419-12.613-4.958-10.61-3.247-11.115-3.812-11.578-12.94-.15-2.965-.28-7.324-.29-9.686-.017-4.236-.007-4.296.74-4.294 1.749.003 12.215 1.384 16.426 2.167 20.678 3.843 46.648 13.602 66.373 24.939 16.314 9.376 36.585 24.657 47.918 36.12l3.275 3.314.51 16.846c2.004 66.289 1.308 109.044-2.533 155.49-2.335 28.23-6.75 61.417-8.234 61.882-.185.058-2.535-.934-5.222-2.203",
      key: "right",
      interactive: true,
    },
    {
      d: "M302.7 167.132c-7.287 0-12.02-8.12-12.148-17.211 0 0-.168-43.835.523-56.425 1.46-11.653 11.312-15.047 22.094-15.122 5.703-.04 20.63 1.134 23.084 14.275.564 3.025.995 45.489.995 45.489l-.006 12.293c-.006 12.045-10.427 16.34-10.427 16.34z",
      key: "middle",
      interactive: true,
    },
    {
      d: "M166.018 208.217s-4.838.38-8.836 1.164c-3.923.768-5.81.932-6.26 7.753-.758 11.431 2.442 67.425 2.442 67.425s.283 4.18 1.271 7.32c.53 1.687 2.523 3.237 3.5 4.367 2.662 3.081 7.715 1.25 16.98.245z",
      key: "forward",
      interactive: true,
    },
    {
      d: "M186.049 385.114s-4.801.709-8.873.837c-3.995.126-5.871.387-7.832-6.161-3.288-10.975-12.659-66.271-12.659-66.271s-.656-4.138-.393-7.42c.14-1.762 1.737-3.717 2.437-5.037 1.908-3.597 7.242-2.94 16.498-4.026z",
      key: "back",
      interactive: true,
    },
    {
      d: "M 241.575 384.042 a 12.53 12.53 0 1 0 0.001 0",
      key: "dpi",
      interactive: true,
    },
  ];

  return (
    <Flex direction={"column"} alignItems={"center"} p={4} gap={4}>
      <CardComponent title="Buttons" width={800}>
        <NativeSelect.Root
          variant={"outline"}
          colorPalette={"purple"}
          disabled={!selected}
        >
          <NativeSelect.Field
            value={localButtonValue}
            onChange={(event) =>
              handleChange(event.target.value as ButtonBindingName)
            }
          >
            {buttonBindingKeys.map((button) => (
              <option value={button} key={button}>
                {button}
              </option>
            ))}
          </NativeSelect.Field>
        </NativeSelect.Root>
        <Separator mt={2} />
        <MouseSvg
          selectedKey={selected}
          onSelect={(key) => setSelected(key as ButtonMappingKey)}
          paths={interactivePaths}
        />
      </CardComponent>
    </Flex>
  );
};
